<!DOCTYPE html>
<html>
	<head>
		<title></title>
		<meta charset="utf-8">
   		<meta http-equiv="X-UA-Compatible" content="IE=edge">
   		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
		<link rel="stylesheet" type="text/css" href="main.css">
	
	</head>
	<body>
	
	<div class="container">
		<div class="jumbotron jumbotron-fluid">
			<h1>ATG Animal Appreciation</h1>
			<button id="start">Pay with Payment Request API</button>
			<div id="result"></div>
		</div>
		<div id="root" class="container-fluid">
			
		</div>

	</div>

	<script type="text/javascript" src="https://js.pay.jp/"></script>
	<script>
	// payjpjs のセットアップ
	Payjp.setPublicKey("pk_test_0383a1b8f91e8a6e3ea0e2a9");
	function onBuyClicked() {
	  if (!window.PaymentRequest) {
	    // PaymentRequest API is not available. Forwarding to
	    // legacy form based experience.
	    location.href = '/checkout';
	    return;
	  }
	  // Supported payment methods
	  var supportedInstruments = [{
	      supportedMethods: ['basic-card'],
	      data: {
	        supportedNetworks: [
	          'visa', 'mastercard', 'amex', 'discover',
	          'diners', 'jcb', 'unionpay'
	        ]
	      }
	  }];
	  // Checkout details
	  var details = {
	    displayItems: [{
	      label: 'Subtotal',
	      amount: { currency: 'USD', value: '20.00' }
	    }, {
	      label: 'Discount',
	      amount: { currency: 'USD', value: '0.00' }
	    }],
	    total: {
	      label: 'Tax',
	      amount: { currency: 'USD', value : '25.00' }
	    }
	  };
	  // 1. Create a `PaymentRequest` instance
	  // 1. `PaymentRequest` インスタンスを生成する
	  var request = new PaymentRequest(supportedInstruments, details);
	  // 2. Show the native UI with `.show()`
	  // 2. `.show()` を呼び出して、ネイティブ UI を表示する
	  request.show()
	  // 3. Process the payment
	  // 3. 決済処理をおこなう
	  .then(result => {
	    // POST the payment information to the server
	    const card = {
	        number: result.details.cardNumber,
	        exp_month: result.details.expiryMonth,
	        exp_year: result.details.expiryYear,
	        cvc: result.details.cardSecurityCode,
	    };
	    // Payjp.createToken(card, function(status, response) {
	    //   if (status == 200) {
	    //     document.getElementById('result').innerText = `PAY.JP Token: ${response.id}`;
	    //     return result.complete('success');
	    //   } else {
	    //     // handle error like displaying error message.
	    //     document.getElementById('result').innerText = 'なんか失敗しました';
	    //     return result.complete('fail');
	    //   };
	    // });
	  });
	}
	document.querySelector('#start').addEventListener('click', onBuyClicked);
	</script>


		
	<script src="https://code.jquery.com/jquery-2.2.0.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-md5/2.2.0/js/md5.js"></script>
	<script src="https://fb.me/react-0.13.3.js"></script>
  	<script src="https://fb.me/JSXTransformer-0.13.3.js"></script>
  	<script src="https://unpkg.com/react-payment-request/dist/react-payment-request.js"></script>
	<script type="text/javascript" src="../static/bundle.js"></script>
	</body>
</html>